<div class="modal-backdrop" (click)="close()"></div>

<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <h2 class="modal-title">
        {{ isEditing ? 'Editar Receta' : 'Crear Nueva Receta' }}
      </h2>

      <form class="recipe-form" [formGroup]="recipeForm" (ngSubmit)="saveRecipe()">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Nombre de la Receta</label>
            <input 
              type="text" 
              class="form-input" 
              placeholder="Ejemplo: Tacos"
              formControlName="name"
            >
          </div>

          <div class="form-group">
            <label class="form-label">Tiempos de Comida</label>
            <select class="form-select" formControlName="mealTime">
              <option value="">Selecciona un tiempo de comida</option>
              <option value="Desayuno">Desayuno</option>
              <option value="Almuerzo">Almuerzo</option>
              <option value="Cena">Cena</option>
              <option value="Postre">Postre</option>
              <option value="Snack">Snack</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Tiempo de Preparaci칩n (minutos)</label>
            <input 
              type="number" 
              class="form-input" 
              placeholder="30"
              formControlName="prepTime"
            >
          </div>

          <div class="form-group">
            <label class="form-label">Porciones</label>
            <input 
              type="number" 
              class="form-input" 
              placeholder="4"
              formControlName="servings"
            >
          </div>
        </div>

        <div class="ingredients-section">
          <div class="section-header">
            <label class="form-label">Ingredientes</label>
            <button type="button" class="btn-add-ingredient" (click)="addIngredient()">
              <span class="plus-icon">+</span>
              A침adir Ingrediente
            </button>
          </div>

          <div class="ingredients-list" formArrayName="ingredients">
            @for(ingredient of ingredients.controls; track $index; let i = $index){
            <div class="ingredient-row" [formGroupName]="i">
              <input 
                type="text" 
                class="ingredient-input name" 
                placeholder="Nombre del Ingrediente"
                formControlName="name"
              >
              <input 
                type="text" 
                class="ingredient-input quantity" 
                placeholder="Cantidad"
                formControlName="quantity"
              >
              <input 
                type="text" 
                class="ingredient-input unit" 
                placeholder="Unidades (Taza, gramos, etc)"
                formControlName="unit"
              >
              <select 
                class="ingredient-select" 
                formControlName="type"
              >
                <option value="">Selecciona tipo</option>
                <option value="Org치nico">Org치nico</option>
                <option value="Procesado">Procesado</option>
                <option value="Natural">Natural</option>
              </select>
              <button 
                type="button" 
                class="btn-delete-ingredient" 
                (click)="removeIngredient(i)"
                [disabled]="ingredients.length === 1"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>}
          </div>
        </div>

        <div class="form-group full-width">
          <label class="form-label">Instrucciones (Opcional)</label>
          <textarea 
            class="form-textarea" 
            placeholder="Ingresa las instrucciones..."
            formControlName="instructions"
            rows="5"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn-save">
            {{ isEditing ? 'Actualizar Receta' : 'Guardar Receta' }}
          </button>
          <button type="button" class="btn-cancel" (click)="onCancel()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>